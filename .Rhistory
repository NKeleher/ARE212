y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab, size = as.factor(lab))) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 1)
) +
scale_size_manual(
values = c(4, 1))
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab, size = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 1)
) +
scale_size_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(4, 1))
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 1)
)
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(19, 16)
)
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 1)
)
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_hline(yintercept = 0, color = "black") +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 1)
)
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_hline(yintercept = 0, color = "black") +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 1)
)
plot(out)
out
felm(
n_total_incident ~
# log(n_total_incident) ~
# I(1e4 * n_total_incident / pop_total) ~
# log(n_total_incident / pop_total) ~
trt |
city_name + week + year |
0 |
city_name,
data = tmp
# data = tmp[pop_total != 0]
) %>% summary
tmp
# Regression -------------------------------------------------------------------
tmp <- sub_yw[(year(date) >= 2007)]
tmp[, trt := 1 * (date >= ymd(20121101)) & (city_name == "denver")]
tmp[, yw := paste0(year, "_", week)]
tmp[, date_num := unclass(date)]
felm(
n_total_incident ~
# log(n_total_incident) ~
# I(1e4 * n_total_incident / pop_total) ~
# log(n_total_incident / pop_total) ~
trt |
city_name + week + year |
0 |
city_name,
data = tmp
# data = tmp[pop_total != 0]
) %>% summary
out$att.avg
# General R setup ----
# Options
options(stringsAsFactors = F)
# Load new packages
pacman::p_load(lubridate, rgdal, raster, broom, rgeos, GISTools)
# Load old packages
pacman::p_load(dplyr, ggplot2, ggthemes, magrittr, viridis)
# My ggplot2 theme
theme_ed <- theme(
legend.position = "bottom",
panel.background = element_rect(fill = NA),
# panel.border = element_rect(fill = NA, color = "grey75"),
axis.ticks = element_line(color = "grey95", size = 0.3),
panel.grid.major = element_line(color = "grey95", size = 0.3),
panel.grid.minor = element_line(color = "grey95", size = 0.3),
legend.key = element_blank())
# My directory
dir_12 <- "/Users/edwardarubin/Dropbox/Teaching/ARE212/Section12/"
# Loading a shapefile ----
# Load the shapefile with the Chicago beats data
beats_shp <- readOGR(
dsn = paste0(dir_12, "ChicagoPoliceBeats"),
layer = "chiBeats")
beats_shp %>% names
beats_shp %>% slotNames()
beats_shp@data %>% names
beats_shp@data %>% dim
# Options
options(stringsAsFactors = F)
options(scipen = 10)
# Packages
library(pacman)
p_load(readr, dplyr, magrittr, parallel, ggplot2, GGally, tidyr, viridis)
# Directories
dir_212 <- "/Users/edwardarubin/Dropbox/Teaching/ARE212Other/"
dir_ps3 <- dir_212 %>% paste0("ProblemSets2018/PS3Solutions/")
# My ggplot2 theme
theme_ed <- theme(
legend.position = "bottom",
panel.background = element_rect(fill = NA),
# panel.border = element_rect(fill = NA, color = "grey75"),
axis.ticks = element_line(color = "grey95", size = 0.3),
panel.grid.major = element_line(color = "grey95", size = 0.3),
panel.grid.minor = element_line(color = "grey95", size = 0.3),
legend.key = element_blank())
# Read data
wage_df <- paste0(dir_ps3, "nls80.csv") %>% read_csv()
devtools::install_github("ggobi/ggally")
library(pacman)
p_load(fields)
?designer.colors
designer.colors(500, c("dark blue", "white", "dark red"), x = c(0, 40, 140))
designer.colors(500, c("dark blue", "white", "dark red"), x = c(0, 40, 140)/140)
designer.colors(500, c("dark blue", "white", "dark red"), x = c(0, 40, 140)/140) == designer.colors(500, c("dark blue", "white", "dark red"), x = c(0, 40, 140))
# General R setup ----
# Options
options(stringsAsFactors = F)
# Load new packages
library(pacman)
p_load(ggmap, leaflet)
# Load old packages
p_load(lubridate, rgdal, raster, broom, rgeos, GISTools)
p_load(dplyr, ggplot2, ggthemes, magrittr, viridis)
# My ggplot2 theme
theme_ed <- theme(
legend.position = "bottom",
panel.background = element_rect(fill = NA),
# panel.border = element_rect(fill = NA, color = "grey75"),
axis.ticks = element_line(color = "grey95", size = 0.3),
panel.grid.major = element_line(color = "grey95", size = 0.3),
panel.grid.minor = element_line(color = "grey95", size = 0.3),
legend.key = element_blank())
# My directories
dir_12 <- "/Users/edwardarubin/Dropbox/Teaching/ARE212/Section12/"
dir_13 <- "/Users/edwardarubin/Dropbox/Teaching/ARE212/Section13/"
library(rmarkdown)
setwd("/Users/edwardarubin/Dropbox/Teaching/ARE212")
render_site("section13.Rmd")
plot(pm_2016 - pm_2010, col = viridis(1e3))
crop(pm_2016 - pm_2010, ) %>% plot(col = inferno(1e3))
plot(pm_2016 - pm_2010, col = inferno(1e3))
plot(pm_2016 - pm_2010, col = plasma(1e3))
plot(pm_2016 - pm_2010, col = magma(1e3))
plot(pm_2016, col = inferno(1e3))
plot(pm_2016 - pm_2010, col = inferno(1e3))
plot(pm_2010, col = inferno(1e3))
plot(pm_2016, col = inferno(1e3))
pm_2010
pm_2016
max(pm_2010)
getValues(pm_2010) %>% max
getValues(pm_2010) %>% max(na.rm = T)
getValues(pm_2010) %>% min(na.rm = T)
pm_max <- c(getValues(pm_2010), getValues(pm_2016)) %>% max(na.rm = T)
pm_min <- c(getValues(pm_2010), getValues(pm_2016)) %>% min(na.rm = T)
pm_max
pm_min
?designer.colors
mean(pm_min, pm_max)
pm_max
pm_min
c_scale <- designer.colors(
n = 500,
col = viridis(3),
x = pm_min, 0.5 * (pm_min + pm_max), pm_max
)
c_scale <- designer.colors(
n = 500,
col = viridis(3),
x = c(pm_min, 0.5 * (pm_min + pm_max), pm_max)
)
c_scale
plot(pm_2010, col = c_scale)
plot(pm_2016, col = c_scale)
plot(pm_2016 - pm_2010, col = inferno(1e3))
diff_min <- getValues(pm_2016 - pm_2010) %>% min(na.rm = T)
diff_max <- getValues(pm_2016 - pm_2010) %>% max(na.rm = T)
diff_min
diff_max
c_scale <- designer.colors(
n = 500,
col = inferno(3)[c(1,3,2)],
x = c(diff_min, 0, diff_max)
)
c_scale
plot(pm_2016 - pm_2010, col = c_scale)
c_scale <- designer.colors(
n = 500,
col = c(inferno(3)[1], "white", inferno(3)[3]),
x = c(diff_min, 0, diff_max)
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
c_scale <- designer.colors(
n = 500,
col = c("#d7191c", "#ffffbf", "#2c7bb6"),
x = c(diff_min, 0, diff_max)
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
c_scale <- designer.colors(
n = 500,
col = c("#d7191c", "#ffffbf", "#2c7bb6"),
x = c(diff_min, 0, diff_max),
alpha = 1
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
c_scale <- designer.colors(
n = 500,
# col = c("#d7191c", "#ffffbf", "#2c7bb6"),
col = plasma(3)[c(1,2,3)],
x = c(diff_min, 0, diff_max),
alpha = 1
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
<!-- ```{R, plot ncdf constant color, fig.height = 8} -->
# Create the color scale
c_scale <- designer.colors(
n = 500,
# col = c("#d7191c", "#ffffbf", "#2c7bb6"),
col = plasma(3)[c(1, 3, 2)],
x = c(diff_min, 0, diff_max),
alpha = 1
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
<!-- ``` -->
diff_r <- abs(diff_max - diff_min)
diff_r
diff_min/diff_r,
diff_min/diff_r
c_scale <- designer.colors(
n = 500,
col = c("#d7191c", "#ffffbf", "#2c7bb6"),
x = c(diff_min, , 0, diff_max),
alpha = 1
)
# Create the color scale
c_scale <- designer.colors(
n = 500,
col = c("#d7191c", "#ffffbf", "#2c7bb6"),
x = c(diff_min, 0, diff_max),
alpha = 1
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
c_scale <- designer.colors(
n = 500,
col = c("#d7191c", "grey80", "#2c7bb6"),
x = c(diff_min, 0, diff_max),
alpha = 1
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
c_scale <- designer.colors(
n = 500,
col = c("#d7191c", "grey90", "#2c7bb6"),
x = c(diff_min, 0, diff_max),
alpha = 1
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
c_scale <- designer.colors(
n = 500,
col = c(inferno(3)[1], "grey90", inferno(3)[3]),
x = c(diff_min, 0, diff_max),
alpha = 1
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
c_scale <- designer.colors(
n = 500,
col = c(magma(3)[1], "grey90", magma(3)[3]),
x = c(diff_min, 0, diff_max),
alpha = 1
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
c_scale <- designer.colors(
n = 500,
col = c(plasma(5)[2], "grey90", plasma(5)[5]),
x = c(diff_min, 0, diff_max),
alpha = 1
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
c_scale <- designer.colors(
n = 500,
col = c(plasma(5)[3], "grey90", plasma(5)[5]),
x = c(diff_min, 0, diff_max),
alpha = 1
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
# Create the color scale
c_scale <- designer.colors(
n = 500,
col = c(plasma(5)[2], "grey90", plasma(5)[4]),
x = c(diff_min, 0, diff_max),
alpha = 1
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
c_scale <- designer.colors(
n = 500,
col = c(plasma(5)[1], "grey90", plasma(5)[4]),
x = c(diff_min, 0, diff_max),
alpha = 1
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
# Create the color scale
c_scale <- designer.colors(
n = 500,
col = c(plasma(100)[25], "grey90", plasma(100)[70]),
x = c(diff_min, 0, diff_max),
alpha = 1
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
c_scale <- designer.colors(
n = 500,
col = c(plasma(100)[25], "grey90", plasma(100)[60]),
x = c(diff_min, 0, diff_max),
alpha = 1
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
# Create the color scale
c_scale <- designer.colors(
n = 500,
col = c(plasma(100)[25], "grey90", plasma(100)[50]),
x = c(diff_min, 0, diff_max),
alpha = 1
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
# Create the color scale
c_scale <- designer.colors(
n = 500,
col = c(plasma(100)[25], "grey90", plasma(100)[70]),
x = c(diff_min, 0, diff_max),
alpha = 1
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
c_scale <- designer.colors(
n = 500,
col = c(inferno(100)[25], "grey90", inferno(100)[70]),
x = c(diff_min, 0, diff_max),
alpha = 1
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
# Create the color scale
c_scale <- designer.colors(
n = 500,
col = c(inferno(100)[25], "grey95", inferno(100)[70]),
x = c(diff_min, 0, diff_max),
alpha = 1
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
# Create the color scale
c_scale <- designer.colors(
n = 500,
col = c(inferno(100)[25], "grey90", inferno(100)[70]),
x = c(diff_min, 0, diff_max),
alpha = 1
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
# Create the color scale
c_scale <- designer.colors(
n = 500,
col = c(inferno(100)[25], "grey92", inferno(100)[70]),
x = c(diff_min, 0, diff_max),
alpha = 1
)
# Plot again
plot(pm_2016 - pm_2010, col = c_scale)
?crop
?extent
crop(pm_2016 - pm_2010, extent(25, 150, -25, 50)) %>%
plot(col = c_scale)
crop(pm_2016 - pm_2010, extent(25, 150, -25, 50)) %>%
plot(col = c_scale, axes = F)
crop(pm_2016 - pm_2010, extent(25, 150, -25, 50)) %>%
plot(col = c_scale, axes = F, bty = "n")
crop(pm_2016 - pm_2010, extent(25, 150, -25, 50)) %>%
plot(col = c_scale, axes = F, frame.plot=FALSE)
crop(pm_2016 - pm_2010, extent(25, 150, -25, 50)) %>%
plot(col = c_scale, axes = F, bty = "L")
crop(pm_2016 - pm_2010, extent(25, 150, -25, 50)) %>%
plot(col = c_scale, axes = F, bty = 'l')
crop(pm_2016 - pm_2010, extent(25, 150, -25, 50)) %>%
plot(col = c_scale, axes = F, box = F)
plot(pm_2016 - pm_2010, col = inferno(1e3), box = F)
plot(pm_2016 - pm_2010, col = inferno(1e3), axes = F, box = F)
