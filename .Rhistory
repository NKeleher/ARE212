aes(color = i_denver, shape = i_denver, alpha = i_denver, size = i_denver)) +
theme_pander() +
scale_color_manual(values = c("grey70", "black")) +
scale_alpha_manual(values = c(0.4, 1)) +
scale_size_manual(values = c(1.4, 1.5)) +
scale_shape_manual(values = c(19, 19))
ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = dm_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "orange", size = 1.5, alpha = 0.2) +
# geom_smooth(aes(group = denver_period, color = i_denver), se = F) +
geom_point(
aes(color = i_denver, shape = i_denver, alpha = i_denver, size = i_denver)) +
theme_pander() +
scale_color_manual(values = c("grey70", "black")) +
scale_alpha_manual(values = c(0.4, 1)) +
scale_size_manual(values = c(1.4, 1.5)) +
scale_shape_manual(values = c(1, 23))
ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = dm_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "orange", size = 1.5, alpha = 0.2) +
# geom_smooth(aes(group = denver_period, color = i_denver), se = F) +
geom_point(
aes(color = i_denver, shape = i_denver, alpha = i_denver, size = i_denver)) +
theme_pander() +
scale_color_manual(values = c("grey70", "black")) +
scale_alpha_manual(values = c(0.4, 1)) +
scale_size_manual(values = c(1.4, 2)) +
scale_shape_manual(values = c(1, 18))
ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = dm_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "blue", size = 1.5, alpha = 0.2) +
geom_point(
aes(color = i_denver, shape = i_denver, alpha = i_denver, size = i_denver)) +
theme_pander() +
scale_color_manual(values = c("grey70", "black")) +
scale_alpha_manual(values = c(0.4, 1)) +
scale_size_manual(values = c(1.4, 2)) +
scale_shape_manual(values = c(1, 18))
ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = dm_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "blue", size = 1.5, alpha = 0.2) +
geom_point(
aes(color = i_denver, shape = i_denver, alpha = i_denver, size = i_denver)) +
theme_pander() +
scale_color_manual(values = c("grey70", "black")) +
scale_alpha_manual(values = c(0.4, 1)) +
scale_size_manual(values = c(1.4, 2.5)) +
scale_shape_manual(values = c(1, 18))
ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = dm_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "blue", size = 1.5, alpha = 0.2) +
geom_point(
aes(color = i_denver, shape = i_denver, alpha = i_denver, size = i_denver)) +
theme_pander() +
scale_color_manual(values = c("grey70", "black")) +
scale_alpha_manual(values = c(0.4, 1)) +
scale_size_manual(values = c(1.4, 2.5)) +
scale_shape_manual(values = c(1, 16))
ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = dm_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "blue", size = 1.5, alpha = 0.2) +
geom_point(
aes(color = i_denver, shape = i_denver, alpha = i_denver, size = i_denver)) +
theme_pander() +
scale_color_manual(values = c("grey70", "black")) +
scale_alpha_manual(values = c(0.4, 1)) +
scale_size_manual(values = c(1.5, 2)) +
scale_shape_manual(values = c(1, 16))
ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = dm_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_point(
aes(color = i_denver, shape = i_denver, alpha = i_denver, size = i_denver)) +
theme_pander() +
scale_color_manual(values = c("grey70", "black")) +
scale_alpha_manual(values = c(0.4, 1)) +
scale_size_manual(values = c(1.5, 2)) +
scale_shape_manual(values = c(1, 16))
ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = dm_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(aes(color = i_denver)) +
geom_point(
aes(color = i_denver, shape = i_denver, alpha = i_denver, size = i_denver)) +
theme_pander() +
scale_color_manual(values = c("grey70", "black")) +
scale_alpha_manual(values = c(0.4, 1)) +
scale_size_manual(values = c(1.5, 2)) +
scale_shape_manual(values = c(1, 16))
ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = dm_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(aes(color = i_denver), se = F, linetype = "dashed") +
geom_point(
aes(color = i_denver, shape = i_denver, alpha = i_denver, size = i_denver)) +
theme_pander() +
scale_color_manual(values = c("grey70", "black")) +
scale_alpha_manual(values = c(0.4, 1)) +
scale_size_manual(values = c(1.5, 2)) +
scale_shape_manual(values = c(1, 16))
ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(aes(color = i_denver), se = F, linetype = "dashed") +
geom_point(
aes(color = i_denver, shape = i_denver, alpha = i_denver, size = i_denver)) +
theme_pander() +
scale_color_manual(values = c("grey70", "black")) +
scale_alpha_manual(values = c(0.4, 1)) +
scale_size_manual(values = c(1.5, 2)) +
scale_shape_manual(values = c(1, 16))
ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(aes(color = i_denver), se = F, linetype = "dashed") +
geom_point(
aes(color = i_denver, shape = i_denver, alpha = i_denver, size = i_denver)) +
theme_pander() +
scale_color_manual(values = c("grey70", "black")) +
scale_alpha_manual(values = c(0.4, 1)) +
scale_size_manual(values = c(1.5, 2)) +
scale_shape_manual(values = c(1, 16))
ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "purple", size = 1.5, alpha = 0.2) +
geom_smooth(aes(color = i_denver), se = F, linetype = "dashed") +
geom_point(
aes(color = i_denver, shape = i_denver, alpha = i_denver, size = i_denver)) +
theme_pander() +
scale_color_manual(values = c("grey70", "black")) +
scale_alpha_manual(values = c(0.4, 1)) +
scale_size_manual(values = c(1.5, 2)) +
scale_shape_manual(values = c(1, 16))
ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(aes(color = i_denver), se = F, linetype = "dashed") +
geom_point(
aes(color = i_denver, shape = i_denver, alpha = i_denver, size = i_denver)) +
theme_pander() +
scale_color_manual(values = c("grey70", "black")) +
scale_alpha_manual(values = c(0.4, 1)) +
scale_size_manual(values = c(1.5, 2)) +
scale_shape_manual(values = c(1, 16))
ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(aes(color = i_denver), se = F, linetype = "dashed") +
geom_point(
aes(color = i_denver, shape = i_denver, alpha = i_denver, size = i_denver)) +
theme_pander() +
scale_color_manual(values = c("grey70", "black")) +
scale_alpha_manual(values = c(0.4, 1)) +
scale_size_manual(values = c(1.5, 2)) +
scale_shape_manual(values = c(1, 16))
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_total)) +
ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(aes(color = i_denver), se = F, linetype = "dashed") +
geom_point(
aes(color = i_denver, shape = i_denver, alpha = i_denver, size = i_denver)) +
theme_pander() +
scale_color_manual(values = c("grey70", "black")) +
scale_alpha_manual(values = c(0.4, 1)) +
scale_size_manual(values = c(1.5, 2)) +
scale_shape_manual(values = c(1, 16))
# Setup ------------------------------------------------------------------------
# Options
options(stringsAsFactors = F)
Sys.setenv(TZ = "US/Pacific")
# Packages
library(pacman)
p_load(
ggplot2, ggthemes, viridis,
lfe,
data.table, lubridate, stringr, magrittr)
# Directories
dir_projects <- "/Users/edwardarubin/Dropbox/Research/MyProjects/"
dir_project  <- dir_projects %>% paste0("DispensariesDenver/")
dir_rds      <- dir_project %>% paste0("DataR/")
# Load data --------------------------------------------------------------------
# Load the aggregated drug incidents data
# NOTE: The drug incident dataset is about 2.66 GB
drug_dt <- dir_rds %>% paste0("NIBRS/nibrsDrug.rds") %>% readRDS()
# Basic data work --------------------------------------------------------------
# Convert dates to date format
drug_dt[, `:=`(
incident_date = ymd(incident_date),
date_ori_added = ymd(date_ori_added)
)]
# Calculate total population
drug_dt[, pop_total := pop1 + pop2 + pop3 + pop4 + pop5]
# Drop unwanted columns
drug_dt[, `:=`(
date_ori_nibrs = NULL,
fips1 = NULL,
fips2 = NULL,
fips3 = NULL,
fips4 = NULL,
fips5 = NULL,
pop1 = NULL,
pop2 = NULL,
pop3 = NULL,
pop4 = NULL,
pop5 = NULL,
NULL = NULL
)]
# Lower case city names and state
drug_dt[, `:=`(
city_name = str_to_lower(city_name),
state_abb = str_to_lower(state_abb)
)]
# Count the number of incidents and the min/max dates
tmp <- drug_dt[, .(
min_date = min(incident_date),
max_date = max(incident_date),
n = .N
), by = .(agency_id, city_name)]
tmp[, n_days := as.numeric(max_date - min_date)]
tmp[, n_per_day := n / n_days]
# Order by incidents per day
setorder(tmp, -n_per_day)
# Choose top 25 arrest departments
#   - with at least 5 years
#   - including 2014 as one of the years
tmp <- tmp[(n_days > 5 * 365.25) & year(max_date) >= 2014][1:25]
sub_dt <- drug_dt[agency_id %in% tmp[,agency_id]]
sub_dt[, week := week(incident_date)]
sub_dt[, i_black :=
grepl("black", race1) | grepl("black", race2) | grepl("black", race3)]
sub_yw <- sub_dt[, .(
n_black = sum(i_black),
n_total = .N,
date = min(floor_date(incident_date, unit = "week"))
), by = .(year, week, city_name, state_abb)]
sub_yw[, `:=`(
dm_black = n_black - mean(n_black),
dm_total = n_total - mean(n_total)
), by = month(date)]
sub_yw[, i_denver := (1 * (city_name == "denver")) %>% as.character()]
sub_yw[date < ymd(20121101), period := "1"]
sub_yw[between(date, ymd(20121101), ymd(20130601)), period := "2"]
sub_yw[between(date, ymd(20130601), ymd(20140101)), period := "3"]
sub_yw[date > ymd(20140101), period := "4"]
sub_yw[, denver_period := paste0(i_denver, period)]
sub_yw[, city_period := paste0(city_name, period)]
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_total)) +
ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(aes(color = i_denver), se = F, linetype = "dashed") +
geom_point(
aes(color = i_denver, shape = i_denver, alpha = i_denver, size = i_denver)) +
theme_pander() +
scale_color_manual(values = c("grey70", "black")) +
scale_alpha_manual(values = c(0.4, 1)) +
scale_size_manual(values = c(1.5, 2)) +
scale_shape_manual(values = c(1, 16))
ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(aes(color = i_denver), se = F, linetype = "dashed") +
geom_point(
aes(color = i_denver, shape = i_denver, alpha = i_denver, size = i_denver)) +
theme_pander() +
scale_color_manual(values = c("grey70", "black")) +
scale_alpha_manual(values = c(0.4, 1)) +
scale_size_manual(values = c(1.5, 2)) +
scale_shape_manual(values = c(1, 16))
sub_dt
sub_yw
ggplot(data = sub_yw[year(date) > 2005 & city_name == "denver"], aes(x = date, y = n_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(aes(color = i_denver), se = F, linetype = "dashed") +
geom_point(
aes(color = i_denver, shape = i_denver, alpha = i_denver, size = i_denver)) +
theme_pander() +
scale_color_manual(values = c("grey70", "black")) +
scale_alpha_manual(values = c(0.4, 1)) +
scale_size_manual(values = c(1.5, 2)) +
scale_shape_manual(values = c(1, 16))
ggplot(data = sub_yw[year(date) > 2005 & city_name == "denver"], aes(x = date, y = n_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(aes(group = period), se = F, linetype = "dashed") +
geom_point() +
theme_pander()
?geom_smooth
ggplot(data = sub_yw[year(date) > 2005 & city_name == "denver"], aes(x = date, y = n_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(formula = y ~ x, aes(group = period), se = F, linetype = "dashed") +
geom_point() +
theme_pander()
?geom_smooth
ggplot(data = sub_yw[year(date) > 2005 & city_name == "denver"], aes(x = date, y = n_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(formula = y ~ x, method = lm, aes(group = period), se = F, linetype = "dashed") +
geom_point() +
theme_pander()
ggplot(data = sub_yw[year(date) > 2005 & city_name == "denver"], aes(x = date, y = dm_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(formula = y ~ x, method = lm, aes(group = period), se = F, linetype = "dashed") +
geom_point() +
theme_pander()
ggplot(data = sub_yw[year(date) > 2007 & city_name == "denver"], aes(x = date, y = dm_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(formula = y ~ x, method = lm, aes(group = period), se = F, linetype = "dashed") +
geom_point() +
theme_pander()
ggplot(data = sub_yw[year(date) > 2007 & city_name == "denver"], aes(x = date, y = dm_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(formula = y ~ x, method = lm, aes(group = period == "1"), se = F, linetype = "dashed") +
geom_point() +
theme_pander()
ggplot(data = sub_yw[year(date) > 2007 & city_name == "denver"], aes(x = date, y = dm_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(formula = y ~ x, method = lm, aes(group = period <= "2"), se = F, linetype = "dashed") +
geom_point() +
theme_pander()
ggplot(data = sub_yw[year(date) > 2007 & city_name == "denver"], aes(x = date, y = dm_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(formula = y ~ x, method = lm, aes(group = period <= "1"), se = F, linetype = "dashed") +
geom_point() +
theme_pander()
ggplot(data = sub_yw[year(date) > 2007 & city_name == "denver"], aes(x = date, y = dm_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(formula = y ~ x, method = lm, aes(group = period <= "3"), se = F, linetype = "dashed") +
geom_point() +
theme_pander()
ggplot(data = sub_yw[year(date) > 2007 & city_name == "denver"], aes(x = date, y = dm_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(formula = y ~ x, method = lm, aes(group = period), se = F, linetype = "dashed") +
geom_point() +
theme_pander()
ggplot(data = sub_yw[year(date) > 2007 & city_name == "denver"], aes(x = date, y = n_black / n_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(formula = y ~ x, method = lm, aes(group = period), se = F, linetype = "dashed") +
geom_point() +
theme_pander()
ggplot(data = sub_yw[year(date) > 2007 & city_name == "denver"], aes(x = date, y = n_black / n_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(formula = y ~ x, method = lm, aes(group = period), se = T, linetype = "dashed") +
geom_point() +
theme_pander()
ggplot(data = sub_yw[year(date) > 2007 & city_name == "denver"], aes(x = date, y = n_black / n_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(formula = y ~ x, method = lm, aes(group = period), se = F, linetype = "dashed") +
geom_point() +
theme_pander()
ggplot(data = sub_yw[year(date) > 2007 & city_name == "denver"], aes(x = date, y = n_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(formula = y ~ x, method = lm, aes(group = period), se = F, linetype = "dashed") +
geom_point() +
theme_pander()
ggplot(data = sub_yw[year(date) > 2007 & city_name == "denver"], aes(x = date, y = n_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(formula = y ~ x, method = lm, aes(group = period <= "2"), se = F, linetype = "dashed") +
geom_point() +
theme_pander()
ggplot(data = sub_yw[year(date) > 2007 & city_name == "denver"], aes(x = date, y = n_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(formula = y ~ x, method = lm, aes(group = period <= "1"), se = F, linetype = "dashed") +
geom_point() +
theme_pander()
ggplot(data = sub_yw[year(date) > 2007 & city_name == "denver"], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(formula = y ~ x, method = lm, aes(group = period <= "1"), se = F, linetype = "dashed") +
geom_point() +
theme_pander()
ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(formula = y ~ x, method = lm,
aes(color = i_denver), se = F, linetype = "dashed") +
geom_point(
aes(color = i_denver, shape = i_denver, alpha = i_denver, size = i_denver)) +
theme_pander() +
scale_color_manual(values = c("grey70", "black")) +
scale_alpha_manual(values = c(0.4, 1)) +
scale_size_manual(values = c(1.5, 2)) +
scale_shape_manual(values = c(1, 16))
ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_total)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black)) +
# ggplot(data = sub_yw[year(date) > 2005], aes(x = date, y = n_black / n_total)) +
geom_vline(
xintercept = c(ymd(20140101), ymd(20121101), ymd(20130601)),
color = "black", size = 1.5, alpha = 0.2) +
geom_smooth(formula = y ~ x, method = lm,
aes(color = i_denver, group = denver_period), se = F, linetype = "dashed") +
geom_point(
aes(color = i_denver, shape = i_denver, alpha = i_denver, size = i_denver)) +
theme_pander() +
scale_color_manual(values = c("grey70", "black")) +
scale_alpha_manual(values = c(0.4, 1)) +
scale_size_manual(values = c(1.5, 2)) +
scale_shape_manual(values = c(1, 16))
library(rmarkdown)
setwd("/Users/edwardarubin/Dropbox/Teaching/ARE212")
render("section08.Rmd",
pdf_document(
latex_engine = "xelatex",
toc = T,
number_sections = T,
highlight = "pygments",
pandoc_args = c(
"--metadata=author:\"Ed Rubin\"",
pandoc_variable_arg("mainfont", "Charter"),
pandoc_variable_arg("monofont", "Hack"),
pandoc_variable_arg("fontsize", "11pt")
)
),
output_dir = "Section08")
Rscript -e 'rmarkdown::render_site("section08.Rmd")'
