lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.2, size = 0.5, aes(group = lab), linetype = "dotted") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab, size = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 16)
) +
scale_size_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(2, 1.5))
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab, size = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 16)
) +
scale_size_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(2, 1.5))
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dashed") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab, size = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 16)
) +
scale_size_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(2, 1.5))
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab, size = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 16)
) +
scale_size_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(2, 1.5))
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab, size = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 16)
) +
scale_size_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(2, 1.5))
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab, size = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 1)
) +
scale_size_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(2, 1.5))
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab, size = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 1)
) +
scale_size_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(2, 1))
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab, size = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 1)
) +
scale_size_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(2, 0.5))
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab, size = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 1)
) +
scale_size_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(2, 0.1))
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab, size = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 1)
) +
scale_size_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(2, 4))
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab, size = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 1)
) +
scale_size_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(4, 1))
?scale_size_manual()
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab, size = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 1)
) +
scale_size_manual(
values = c(4, 1))
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab, size = as.factor(lab))) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 1)
) +
scale_size_manual(
values = c(4, 1))
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab, size = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 1)
) +
scale_size_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(4, 1))
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 1)
)
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(19, 16)
)
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 1)
)
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_hline(yintercept = 0, color = "black") +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 1)
)
tmp <- data.table(
x = 1:length(out$Y.tr) - out$T0,
y = c(out$Y.tr, synth = out$Y.ct),
lab = rep(c("A", "B"), each = length(out$Y.tr)))
ggplot(data = tmp, aes(x = x, y = y)) +
geom_vline(xintercept = 0, color = "grey40", size = 2, alpha = 0.3) +
geom_hline(yintercept = 0, color = "black") +
geom_line(alpha = 0.5, size = 0.3, aes(group = lab), linetype = "dotted", color = "grey40") +
# stat_smooth(aes(color = lab), se = F, alpha = 0.5) +
geom_point(size = 1.5, aes(color = lab, shape = lab)) +
xlab("Weeks to legalization") +
theme_pander() +
scale_color_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c("black", "#f50057")
) +
scale_shape_manual("",
labels = c("Denver, reality", "Denver, synthetic control"),
values = c(16, 1)
)
plot(out)
out
felm(
n_total_incident ~
# log(n_total_incident) ~
# I(1e4 * n_total_incident / pop_total) ~
# log(n_total_incident / pop_total) ~
trt |
city_name + week + year |
0 |
city_name,
data = tmp
# data = tmp[pop_total != 0]
) %>% summary
tmp
# Regression -------------------------------------------------------------------
tmp <- sub_yw[(year(date) >= 2007)]
tmp[, trt := 1 * (date >= ymd(20121101)) & (city_name == "denver")]
tmp[, yw := paste0(year, "_", week)]
tmp[, date_num := unclass(date)]
felm(
n_total_incident ~
# log(n_total_incident) ~
# I(1e4 * n_total_incident / pop_total) ~
# log(n_total_incident / pop_total) ~
trt |
city_name + week + year |
0 |
city_name,
data = tmp
# data = tmp[pop_total != 0]
) %>% summary
out$att.avg
# General R setup ----
# Options
options(stringsAsFactors = F)
# Load new packages
pacman::p_load(lubridate, rgdal, raster, broom, rgeos, GISTools)
# Load old packages
pacman::p_load(dplyr, ggplot2, ggthemes, magrittr, viridis)
# My ggplot2 theme
theme_ed <- theme(
legend.position = "bottom",
panel.background = element_rect(fill = NA),
# panel.border = element_rect(fill = NA, color = "grey75"),
axis.ticks = element_line(color = "grey95", size = 0.3),
panel.grid.major = element_line(color = "grey95", size = 0.3),
panel.grid.minor = element_line(color = "grey95", size = 0.3),
legend.key = element_blank())
# My directory
dir_12 <- "/Users/edwardarubin/Dropbox/Teaching/ARE212/Section12/"
# Loading a shapefile ----
# Load the shapefile with the Chicago beats data
beats_shp <- readOGR(
dsn = paste0(dir_12, "ChicagoPoliceBeats"),
layer = "chiBeats")
beats_shp %>% names
beats_shp %>% slotNames()
beats_shp@data %>% names
beats_shp@data %>% dim
# Options
options(stringsAsFactors = F)
options(scipen = 10)
# Packages
library(pacman)
p_load(readr, dplyr, magrittr, parallel, ggplot2, GGally, tidyr, viridis)
# Directories
dir_212 <- "/Users/edwardarubin/Dropbox/Teaching/ARE212Other/"
dir_ps3 <- dir_212 %>% paste0("ProblemSets2018/PS3Solutions/")
# My ggplot2 theme
theme_ed <- theme(
legend.position = "bottom",
panel.background = element_rect(fill = NA),
# panel.border = element_rect(fill = NA, color = "grey75"),
axis.ticks = element_line(color = "grey95", size = 0.3),
panel.grid.major = element_line(color = "grey95", size = 0.3),
panel.grid.minor = element_line(color = "grey95", size = 0.3),
legend.key = element_blank())
# Read data
wage_df <- paste0(dir_ps3, "nls80.csv") %>% read_csv()
devtools::install_github("ggobi/ggally")
setwd("Desktop/Test")
dir
dir()
rmarkdown::render_site("test.Rmd")
setwd("../../Dropbox/Teaching/ARE212/")
rmarkdown::render_site("test.Rmd")
rmarkdown::render_site("test.Rmd")
getwd()
rmarkdown::render_site("test.Rmd")
rmarkdown::render_site("test.Rmd")
rmarkdown::render_site("test.Rmd")
rmarkdown::render_site("test.Rmd")
rmarkdown::render_site("test.Rmd")
rmarkdown::render_site("test.Rmd")
rmarkdown::render_site("test.Rmd")
pm_2010
plot(pm_2010)
crop(pm_2010, extent(-180,180,-50,60)) %>% crop
crop(pm_2010, extent(-180,180,-50,60)) %>% plot()
?plot.window
crop(pm_2010, extent(-180,180,-50,60)) %>% plot()
par(mfrow = c(3,3), mar = .1+ c(2,2,3,1))
crop(pm_2010, extent(-180,180,-50,60)) %>% plot()
crop(pm_2010, extent(-180,180,-50,60)) %>% plot()
?grid.draw()
x <- rnorm(10)
x
x == max(x)
which(x == max(x))
x[which(x == max(x))]
